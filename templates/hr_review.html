{% extends "base.html" %}

{% block title %}HR Review - {{ employee.first_name }} {{ employee.surname }}{% endblock %}

{% block content %}
<div class="main-content">
    <h1 style="color: var(--primary-color); margin-bottom: 30px;">HR Review: {{ employee.first_name }} {{ employee.middle_name }} {{ employee.surname }}</h1>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Contractor Information</h3>
        </div>
        <div class="form-row">
            <div><strong>Contractor:</strong> {{ contractor.contractor_name }}</div>
            <div><strong>PO Number:</strong> {{ contractor.po_number }}</div>
            <div><strong>Department:</strong> {{ contractor.department }}</div>
        </div>
        <div style="margin-top: 15px;">
            <strong>Job Description:</strong><br>
            {{ contractor.job_description }}
        </div>
        <div style="margin-top: 20px;">
            <strong>Contractor Signature:</strong><br>
            {% if contractor.signature_path %}
                {% if contractor.signature_path.startswith('http') %}
                    <img src="{{ contractor.signature_path }}" class="signature-preview" alt="Contractor Signature" style="max-width: 250px; max-height: 100px; border: 2px solid #ddd; padding: 8px; margin-top: 10px; border-radius: 4px; background: white;">
                {% else %}
                    <img src="{{ url_for('serve_uploaded_file', filename=contractor.signature_path.replace('\\', '/')) }}" class="signature-preview" alt="Contractor Signature" style="max-width: 250px; max-height: 100px; border: 2px solid #ddd; padding: 8px; margin-top: 10px; border-radius: 4px; background: white;">
                {% endif %}
            {% else %}
                <div style="width: 250px; height: 80px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-top: 10px; color: var(--text-light); background: #f9f9f9;">
                    No Signature
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">1. FULL NAME / પૂરૂ નામ</h3>
        </div>
        <div class="form-row">
            <div><strong>FIRST NAME (નામ):</strong> {{ employee.first_name }}</div>
            <div><strong>MIDDLE NAME (પિતાનું નામ):</strong> {{ employee.middle_name or 'N/A' }}</div>
            <div><strong>SURNAME (અટક):</strong> {{ employee.surname }}</div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">2. ADDRESS (Permanent) / સરનામું (કાયમી)</h3>
        </div>
        {{ employee.address_permanent or 'N/A' }}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">3. ADDRESS (Present) / સરનામું (હાલનું)</h3>
        </div>
        {{ employee.address_present or 'Same as Permanent Address' }}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">4. Date of Birth / જન્મ તારીખ</h3>
        </div>
        <div class="form-row">
            <div><strong>Date of Birth:</strong> {{ employee.dob or 'N/A' }}</div>
            <div><strong>Age (ઉંમર):</strong> {{ employee.age or 'N/A' }}</div>
        </div>
        {% if employee.age_proof %}
        <div style="margin-top: 10px;"><strong>Proof Of Age:</strong> {{ employee.age_proof }}</div>
        {% endif %}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">5. Qualification / શૈક્ષણિક</h3>
        </div>
        {{ employee.qualification or 'N/A' }}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">6. Aadhar Card No. (આધાર કાર્ડ નંબર)</h3>
        </div>
        {{ employee.aadhar or 'N/A' }}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">7. Bank Detail / બેંક વિગત</h3>
        </div>
        {% if employee.bank_name or employee.bank_account or employee.bank_ifsc %}
        <div class="form-row">
            <div><strong>(a) Bank Name:</strong> {{ employee.bank_name or 'N/A' }}</div>
            <div><strong>(b) Account No.:</strong> {{ employee.bank_account or 'N/A' }}</div>
            <div><strong>IFSC Code:</strong> {{ employee.bank_ifsc or 'N/A' }}</div>
        </div>
        {% else %}
        <div>N/A</div>
        {% endif %}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">8. Contact Person in Case of Emergency / કટોકટી વખતે સંપર્ક કરવા</h3>
        </div>
        {% if employee.emergency_name or employee.emergency_mobile or employee.emergency_contact %}
        <div class="form-row">
            <div><strong>a) Name:</strong> {{ employee.emergency_name or employee.emergency_contact or 'N/A' }}</div>
            <div><strong>b) Relation:</strong> {{ employee.emergency_relation or 'N/A' }}</div>
        </div>
        <div style="margin-top: 10px;">
            <strong>c) Address:</strong> {{ employee.emergency_address or 'N/A' }}
        </div>
        <div style="margin-top: 10px;">
            <strong>Phone No:</strong> {{ employee.emergency_phone or employee.emergency_mobile or 'N/A' }}
        </div>
        {% else %}
        <div><strong>Name:</strong> {{ employee.emergency_contact or 'N/A' }}</div>
        <div style="margin-top: 10px;"><strong>Mobile:</strong> {{ employee.emergency_mobile or 'N/A' }}</div>
        {% endif %}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">9. Past Employer With Address & Duration</h3>
        </div>
        {% if employee.past_employer %}
        <div class="form-row">
            <div><strong>Company Name:</strong> {{ employee.past_employer }}</div>
            <div><strong>Duration:</strong> {{ employee.past_duration or 'N/A' }}</div>
        </div>
        <div style="margin-top: 10px;">
            <strong>Address:</strong> {{ employee.past_address or 'N/A' }}
        </div>
        {% else %}
        <div>N/A</div>
        {% endif %}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">10. Reference by / સંબંધિત આપનારાનું નામ</h3>
        </div>
        {% if employee.reference_name %}
        <div class="form-row">
            <div><strong>Name:</strong> {{ employee.reference_name }}</div>
            <div><strong>Contact:</strong> {{ employee.reference_contact or 'N/A' }}</div>
            <div><strong>Relation:</strong> {{ employee.reference_relation or 'N/A' }}</div>
        </div>
        {% else %}
        <div>N/A</div>
        {% endif %}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">11. Remarks / નોંધ</h3>
        </div>
        {{ employee.remarks or 'N/A' }}
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">Documents</h3>
        </div>
        <div class="form-row">
            <div style="text-align: center;">
                <strong>Employee Photo:</strong><br>
                {% if employee.photo_path %}
                    {% if employee.photo_path.startswith('http') %}
                        <img src="{{ employee.photo_path }}" class="image-preview" alt="Employee Photo" style="max-width: 250px; max-height: 300px; border: 2px solid #ddd; padding: 5px; margin-top: 10px; border-radius: 4px;">
                    {% else %}
                        <img src="{{ url_for('serve_uploaded_file', filename=employee.photo_path.replace('\\', '/')) }}" class="image-preview" alt="Employee Photo" style="max-width: 250px; max-height: 300px; border: 2px solid #ddd; padding: 5px; margin-top: 10px; border-radius: 4px;">
                    {% endif %}
                {% else %}
                    <div style="width: 250px; height: 200px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-top: 10px; color: var(--text-light);">
                        No Photo
                    </div>
                {% endif %}
            </div>
            <div style="text-align: center;">
                <strong>Employee Signature:</strong><br>
                {% if employee.signature_path %}
                    {% if employee.signature_path.startswith('http') %}
                        <img src="{{ employee.signature_path }}" class="signature-preview" alt="Employee Signature" style="max-width: 250px; max-height: 100px; border: 2px solid #ddd; padding: 5px; margin-top: 10px; border-radius: 4px;">
                    {% else %}
                        <img src="{{ url_for('serve_uploaded_file', filename=employee.signature_path.replace('\\', '/')) }}" class="signature-preview" alt="Employee Signature" style="max-width: 250px; max-height: 100px; border: 2px solid #ddd; padding: 5px; margin-top: 10px; border-radius: 4px;">
                    {% endif %}
                {% else %}
                    <div style="width: 250px; height: 80px; border: 2px dashed #ccc; display: flex; align-items: center; justify-content: center; margin-top: 10px; color: var(--text-light);">
                        No Signature
                    </div>
                {% endif %}
            </div>
        </div>
        <div style="margin-top: 15px;">
            <strong>Submitted At:</strong> {{ employee.submitted_at[:19] if employee.submitted_at else 'N/A' }}
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">HR Decision</h3>
        </div>
        
        <form method="POST" action="{{ url_for('hr_approve', employee_id=employee.id) }}" style="margin-bottom: 20px;">
            <div class="form-group">
                <label for="approved_by">Approved By (HR Officer Name)</label>
                <input type="text" class="form-control" id="approved_by" name="approved_by" value="HR Department" required>
            </div>
            <button type="submit" class="btn btn-success">✓ Approve Employee</button>
        </form>
        
        <form method="POST" action="{{ url_for('hr_reject', employee_id=employee.id) }}">
            <div class="form-group">
                <label for="approved_by_reject">Rejected By (HR Officer Name)</label>
                <input type="text" class="form-control" id="approved_by_reject" name="approved_by" value="HR Department" required>
            </div>
            <div class="form-group">
                <label for="reason">Rejection Reason</label>
                <textarea class="form-control" id="reason" name="reason" rows="3" required>Documents incomplete or invalid</textarea>
            </div>
            <button type="submit" class="btn btn-danger">✗ Reject Employee</button>
        </form>
    </div>
    
    <div class="btn-group">
        <a href="{{ url_for('hr_dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
    </div>
</div>
{% endblock %}
